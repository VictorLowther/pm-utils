#!/bin/bash

. /etc/pm/functions

suspend_video()
{
	# Suspend all video devices using the HAL dbus methods
	devices=`hal-find-by-capability --capability video_adapter_pm`
	for device in $devices
	do
		dbus-send --system --print-reply --dest=org.freedesktop.Hal \
			  $device org.freedesktop.Hal.Device.VideoAdapterPM.SuspendVideo
	done
}

resume_video()
{
	# Resume all video devices using the HAL dbus methods
	devices=`hal-find-by-capability --capability video_adapter_pm`
	for device in $devices
	do
		dbus-send --system --print-reply --dest=org.freedesktop.Hal \
			  $device org.freedesktop.Hal.Device.VideoAdapterPM.ResumeVideo
	done
}

case "$1" in
	suspend)
		suspend_video
		;;
	resume)
		resume_video
		;;
	hibernate)
		if [ "x$HIBERNATE_RESUME_POST_VIDEO" == "xyes" ]; then
			suspend_video
		fi
		;;
	thaw)
		if [ "x$HIBERNATE_RESUME_POST_VIDEO" == "xyes" ]; then
			resume_video
		fi
		;;
	*)
		;;
esac

exit $?
