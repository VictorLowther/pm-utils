Name: pm-utils
Summary: Power management utilities and scripts for Fedora
License: GPLv2
Version: @TIMESTAMP@
Release: @GITREV@
Group: System Environment/Base
URL: http://pm-utils.freedesktop.org
# for chvt
Requires: kbd
Requires: radeontool
# for hd apm settings
Requires: hdparm
# for on_ac_power
Requires: hal
%ifarch %{ix86} x86_64
Requires: vbetool
%endif
BuildRequires: xmlto

Source21: pm-utils-99hd-apm-restore
Source22: pm-utils-hd-apm-restore.conf
Source23: pm-utils-bugreport-info.sh

BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)


%description
The pm-utils package contains utilities and scripts useful for tasks related
to power management.

%package devel
Summary: Files for development using %{name}
Group: Development/Libraries
Requires: %{name} = %{version}-%{release}
# for /usr/share/pkgconfig
Requires:       pkgconfig

%description devel
This package contains the pkg-config files for development
when building programs that use %{name}.

%prep
pushd "$RPM_BUILD_ROOT"
./autogen.sh
popd

%build
pushd "$RPM_BUILD_ROOT"
%configure
make
popd


%install
pushd "$RPM_BUILD_ROOT"
export DESTDIR="$RPM_BUILD_ROOT/inst"
[ -d $DESTDIR ] && rm -rf "$DESTDIR"
mkdir -p "$DESTDIR"
make install

install -D -m 0600 /dev/null $DESTDIR%{_localstatedir}/log/pm-suspend.log
mkdir -p $DESTDIR%{_localstatedir}/run/pm-utils/{locks,storage}

install -D -m 0755 %{SOURCE21} $DESTDIR%{_libdir}/pm-utils/sleep.d/99hd-apm-restore.hook
install -D -m 0644 %{SOURCE22} $DESTDIR%{_sysconfdir}/pm-utils-hd-apm-restore.conf

install -D -m 0755 %{SOURCE23} $DESTDIR%{_bindir}/pm-utils-bugreport-info.sh
popd

%clean

%files
%defattr(-,root,root,-)
%doc README COPYING AUTHORS ChangeLog
%config(noreplace) %{_sysconfdir}/pm-utils-hd-apm-restore.conf
%{_sysconfdir}/pm/
%dir %{_libdir}/pm-utils/
%{_libdir}/pm-utils/bin/
%{_libdir}/pm-utils/defaults
%{_libdir}/pm-utils/functions
%{_libdir}/pm-utils/pm-functions
%{_libdir}/pm-utils/power.d/
%{_libdir}/pm-utils/sleep.d/
%{_libdir}/pm-utils/module.d
%{_bindir}/on_ac_power
%{_bindir}/pm-is-supported
%{_bindir}/pm-utils-bugreport-info.sh
%{_sbindir}/pm-hibernate
%{_sbindir}/pm-powersave
%{_sbindir}/pm-suspend
%{_sbindir}/pm-suspend-hybrid
%{_mandir}/man1/*.1.gz
%{_mandir}/man8/*.8.gz
%{_localstatedir}/run/pm-utils/
%dir %{_datadir}/doc/pm-utils
%doc %{_datadir}/doc/pm-utils/*

# no logrotate needed, because only one run of pm-utils is stored
# in the logfile
%ghost %verify(not md5 size mtime) %{_localstatedir}/log/pm-suspend.log


%files devel
%defattr(-,root,root,-)
%{_libdir}/pkgconfig/pm-utils.pc
